# E-Log Backend Routes - Ho√†n Thi·ªán API

## üìã **T·ªïng Quan**

H·ªá th·ªëng routes ƒë√£ ƒë∆∞·ª£c ho√†n thi·ªán v·ªõi:

- ‚úÖ Authentication & Authorization middleware
- ‚úÖ Comprehensive validation
- ‚úÖ RESTful API design
- ‚úÖ Error handling chu·∫©n h√≥a
- ‚úÖ Role-based access control

## üöÄ **Routes Structure**

```
/api
‚îú‚îÄ‚îÄ /auth          - Authentication endpoints
‚îú‚îÄ‚îÄ /products      - Product management
‚îú‚îÄ‚îÄ /categories    - Category management
‚îú‚îÄ‚îÄ /customers     - Customer management
‚îú‚îÄ‚îÄ /dashboard     - Dashboard & analytics
‚îú‚îÄ‚îÄ /inventory     - Inventory management
‚îú‚îÄ‚îÄ /inbound       - Inbound operations
‚îú‚îÄ‚îÄ /outbound      - Outbound operations
‚îú‚îÄ‚îÄ /reports       - Reporting & analytics
‚îî‚îÄ‚îÄ /health        - Health check
```

## üîê **Authentication Routes** (`/auth`)

### **Public Endpoints:**

- `POST /auth/register` - ƒêƒÉng k√Ω user m·ªõi
- `POST /auth/login` - ƒêƒÉng nh·∫≠p
- `POST /auth/refresh` - Refresh token

### **Protected Endpoints:**

- `POST /auth/logout` - ƒêƒÉng xu·∫•t
- `PUT /auth/change-password` - ƒê·ªïi m·∫≠t kh·∫©u
- `GET /auth/profile` - L·∫•y th√¥ng tin profile
- `PUT /auth/profile` - C·∫≠p nh·∫≠t profile

### **Validation:**

```javascript
// Register validation
{
  "username": "string (3-20 chars, alphanumeric + underscore)",
  "email": "valid email",
  "password": "min 6 chars, uppercase + lowercase + number",
  "role": "optional (admin|manager|employee)"
}

// Login validation
{
  "email": "valid email",
  "password": "required"
}
```

**Messages ti·∫øng Vi·ªát:**

- "T√™n ƒëƒÉng nh·∫≠p ph·∫£i c√≥ t·ª´ 3 ƒë·∫øn 20 k√Ω t·ª±"
- "T√™n ƒëƒÉng nh·∫≠p ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i, s·ªë v√† d·∫•u g·∫°ch d∆∞·ªõi"
- "Vui l√≤ng cung c·∫•p email h·ª£p l·ªá"
- "M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±"
- "M·∫≠t kh·∫©u ph·∫£i ch·ª©a √≠t nh·∫•t m·ªôt ch·ªØ th∆∞·ªùng, m·ªôt ch·ªØ hoa v√† m·ªôt s·ªë"

## üì¶ **Product Routes** (`/products`)

### **Endpoints:**

- `POST /products` - T·∫°o s·∫£n ph·∫©m m·ªõi (Admin/Manager)
- `GET /products` - L·∫•y danh s√°ch s·∫£n ph·∫©m
- `GET /products/:id` - L·∫•y s·∫£n ph·∫©m theo ID
- `PUT /products/:id` - C·∫≠p nh·∫≠t s·∫£n ph·∫©m (Admin/Manager)
- `DELETE /products/:id` - X√≥a s·∫£n ph·∫©m (Admin)
- `GET /products/sku/:sku` - L·∫•y s·∫£n ph·∫©m theo SKU
- `GET /products/barcode/:barcode` - L·∫•y s·∫£n ph·∫©m theo barcode
- `GET /products/category/:categoryId` - L·∫•y s·∫£n ph·∫©m theo category

### **Query Parameters:**

```javascript
GET /products?page=1&limit=20&search=keyword&categoryId=xxx&isActive=true
```

### **Validation:**

```javascript
// Create product
{
  "name": "string (1-100 chars)",
  "sku": "string (uppercase letters, numbers, hyphens)",
  "barcode": "optional (numbers only)",
  "categoryId": "MongoDB ObjectId",
  "description": "optional (max 500 chars)",
  "price": "positive number",
  "cost": "optional positive number",
  "weight": "optional positive number",
  "dimensions": "optional object",
  "isActive": "optional boolean"
}
```

## üè∑Ô∏è **Category Routes** (`/categories`)

### **Endpoints:**

- `POST /categories` - T·∫°o category m·ªõi (Admin/Manager)
- `GET /categories` - L·∫•y danh s√°ch categories
- `GET /categories/tree` - L·∫•y category tree
- `GET /categories/:id` - L·∫•y category theo ID
- `PUT /categories/:id` - C·∫≠p nh·∫≠t category (Admin/Manager)
- `DELETE /categories/:id` - X√≥a category (Admin)
- `GET /categories/:id/report` - B√°o c√°o category
- `GET /categories/parent/:parentId` - L·∫•y categories theo parent

### **Validation:**

```javascript
// Create category
{
  "name": "string (1-50 chars)",
  "description": "optional (max 200 chars)",
  "parentId": "optional MongoDB ObjectId",
  "isActive": "optional boolean"
}
```

## üë• **Customer Routes** (`/customers`)

### **Endpoints:**

- `POST /customers` - T·∫°o kh√°ch h√†ng m·ªõi (Admin/Manager)
- `GET /customers` - L·∫•y danh s√°ch kh√°ch h√†ng
- `GET /customers/:id` - L·∫•y kh√°ch h√†ng theo ID
- `PUT /customers/:id` - C·∫≠p nh·∫≠t kh√°ch h√†ng (Admin/Manager)
- `DELETE /customers/:id` - X√≥a kh√°ch h√†ng (Admin)
- `GET /customers/email/:email` - L·∫•y kh√°ch h√†ng theo email
- `GET /customers/type/:customerType` - L·∫•y kh√°ch h√†ng theo lo·∫°i

### **Validation:**

```javascript
// Create customer
{
  "name": "string (1-100 chars)",
  "email": "valid email",
  "phone": "optional mobile phone",
  "address": "optional object",
  "customerType": "individual|business",
  "taxId": "optional (10-15 chars)",
  "isActive": "optional boolean"
}
```

## üìä **Dashboard Routes** (`/dashboard`)

### **Endpoints:**

- `GET /dashboard` - T·ªïng quan dashboard
- `GET /dashboard/stats` - Th·ªëng k√™ dashboard
- `GET /dashboard/alerts` - C·∫£nh b√°o
- `GET /dashboard/top-products` - S·∫£n ph·∫©m b√°n ch·∫°y
- `GET /dashboard/recent-activities` - Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y

### **Query Parameters:**

```javascript
GET /dashboard?timeRange=month&startDate=2024-01-01&endDate=2024-01-31&warehouseId=xxx
```

## üì¶ **Inventory Routes** (`/inventory`)

### **Endpoints:**

- `POST /inventory` - T·∫°o inventory m·ªõi (Admin/Manager)
- `GET /inventory` - L·∫•y danh s√°ch inventory
- `GET /inventory/:id` - L·∫•y inventory theo ID
- `PUT /inventory/:id` - C·∫≠p nh·∫≠t inventory (Admin/Manager)
- `DELETE /inventory/:id` - X√≥a inventory (Admin)
- `GET /inventory/product/:productId` - L·∫•y inventory theo s·∫£n ph·∫©m
- `GET /inventory/warehouse/:warehouseId` - L·∫•y inventory theo kho
- `GET /inventory/low-stock` - L·∫•y s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng
- `POST /inventory/adjust` - ƒêi·ªÅu ch·ªânh inventory (Admin/Manager)

### **Validation:**

```javascript
// Create inventory
{
  "productId": "MongoDB ObjectId",
  "warehouseId": "MongoDB ObjectId",
  "quantity": "non-negative integer",
  "reservedQuantity": "optional non-negative integer",
  "minStockLevel": "optional non-negative integer",
  "maxStockLevel": "optional non-negative integer"
}
```

## üì• **Inbound Routes** (`/inbound`)

### **Endpoints:**

- `POST /inbound` - T·∫°o inbound m·ªõi (Admin/Manager)
- `GET /inbound` - L·∫•y danh s√°ch inbound
- `GET /inbound/:id` - L·∫•y inbound theo ID
- `PUT /inbound/:id` - C·∫≠p nh·∫≠t inbound (Admin/Manager)
- `DELETE /inbound/:id` - X√≥a inbound (Admin)
- `POST /inbound/:id/receive` - Nh·∫≠n h√†ng (Admin/Manager)
- `POST /inbound/:id/cancel` - H·ªßy inbound (Admin/Manager)
- `GET /inbound/supplier/:supplierId` - L·∫•y inbound theo nh√† cung c·∫•p
- `GET /inbound/warehouse/:warehouseId` - L·∫•y inbound theo kho

### **Validation:**

```javascript
// Create inbound
{
  "supplierId": "MongoDB ObjectId",
  "warehouseId": "MongoDB ObjectId",
  "expectedDate": "ISO 8601 date",
  "items": [
    {
      "productId": "MongoDB ObjectId",
      "quantity": "positive integer",
      "unitCost": "optional positive number"
    }
  ],
  "notes": "optional (max 500 chars)"
}
```

## üì§ **Outbound Routes** (`/outbound`)

### **Endpoints:**

- `POST /outbound` - T·∫°o outbound m·ªõi (Admin/Manager)
- `GET /outbound` - L·∫•y danh s√°ch outbound
- `GET /outbound/:id` - L·∫•y outbound theo ID
- `PUT /outbound/:id` - C·∫≠p nh·∫≠t outbound (Admin/Manager)
- `DELETE /outbound/:id` - X√≥a outbound (Admin)
- `POST /outbound/:id/ship` - Giao h√†ng (Admin/Manager)
- `POST /outbound/:id/deliver` - X√°c nh·∫≠n giao h√†ng (Admin/Manager)
- `POST /outbound/:id/cancel` - H·ªßy outbound (Admin/Manager)
- `GET /outbound/customer/:customerId` - L·∫•y outbound theo kh√°ch h√†ng
- `GET /outbound/warehouse/:warehouseId` - L·∫•y outbound theo kho

### **Validation:**

```javascript
// Create outbound
{
  "customerId": "MongoDB ObjectId",
  "warehouseId": "MongoDB ObjectId",
  "expectedDate": "ISO 8601 date",
  "items": [
    {
      "productId": "MongoDB ObjectId",
      "quantity": "positive integer",
      "unitPrice": "optional positive number"
    }
  ],
  "shippingAddress": "object",
  "notes": "optional (max 500 chars)"
}
```

## üìà **Report Routes** (`/reports`)

### **Endpoints:**

- `GET /reports/sales` - B√°o c√°o b√°n h√†ng (Admin/Manager)
- `GET /reports/inventory` - B√°o c√°o t·ªìn kho (Admin/Manager)
- `GET /reports/inbound` - B√°o c√°o nh·∫≠p kho (Admin/Manager)
- `GET /reports/outbound` - B√°o c√°o xu·∫•t kho (Admin/Manager)
- `GET /reports/customer` - B√°o c√°o kh√°ch h√†ng (Admin/Manager)
- `GET /reports/product` - B√°o c√°o s·∫£n ph·∫©m (Admin/Manager)
- `GET /reports/warehouse` - B√°o c√°o kho (Admin/Manager)
- `GET /reports/summary` - B√°o c√°o t·ªïng h·ª£p (Admin/Manager)

### **Query Parameters:**

```javascript
GET /reports/sales?startDate=2024-01-01&endDate=2024-01-31&warehouseId=xxx&format=json
```

## üõ°Ô∏è **Authentication & Authorization**

### **Middleware:**

- `authenticateToken` - X√°c th·ª±c JWT token
- `authorize(...roles)` - Ph√¢n quy·ªÅn theo role
- `authorizeOwnerOrAdmin` - Ki·ªÉm tra quy·ªÅn s·ªü h·ªØu ho·∫∑c admin
- `optionalAuth` - X√°c th·ª±c kh√¥ng b·∫Øt bu·ªôc

### **Roles:**

- `admin` - To√†n quy·ªÅn
- `manager` - Qu·∫£n l√Ω (kh√¥ng th·ªÉ x√≥a)
- `employee` - Nh√¢n vi√™n (ch·ªâ xem)

### **Usage:**

```javascript
// Protected route
router.get("/protected", authenticateToken, controller.method);

// Role-based access
router.post(
  "/admin-only",
  authenticateToken,
  authorize("admin"),
  controller.method
);

// Multiple roles
router.put(
  "/manage",
  authenticateToken,
  authorize("admin", "manager"),
  controller.method
);
```

## üìù **Validation**

### **Express Validator:**

- `body()` - Validate request body
- `param()` - Validate URL parameters
- `query()` - Validate query parameters

### **Common Validations:**

- `isMongoId()` - MongoDB ObjectId
- `isEmail()` - Email format
- `isMobilePhone()` - Phone number
- `isISO8601()` - Date format
- `isInt()` - Integer
- `isFloat()` - Float number
- `isBoolean()` - Boolean
- `isArray()` - Array
- `isObject()` - Object
- `isLength()` - String length
- `matches()` - Regex pattern
- `isIn()` - Enum values

## üîß **Error Handling**

### **Validation Errors:**

```javascript
{
  "success": false,
  "message": "Validation errors",
  "errors": [
    {
      "field": "email",
      "message": "Please provide a valid email"
    }
  ]
}
```

### **Authentication Errors:**

```javascript
{
  "success": false,
  "message": "Access token required"
}
```

### **Authorization Errors:**

```javascript
{
  "success": false,
  "message": "Insufficient permissions"
}
```

## üöÄ **Usage Examples**

### **1. Authentication:**

```javascript
// Register
POST /api/auth/register
{
  "username": "admin",
  "email": "admin@example.com",
  "password": "Admin123",
  "role": "admin"
}

// Login
POST /api/auth/login
{
  "email": "admin@example.com",
  "password": "Admin123"
}
```

### **2. Create Product:**

```javascript
POST / api / products;
Authorization: Bearer <
  token >
  {
    name: "iPhone 15",
    sku: "IPH15-128-BLK",
    barcode: "1234567890123",
    categoryId: "64a1b2c3d4e5f6789012345",
    price: 999.99,
    description: "Latest iPhone model",
  };
```

### **3. Get Products with Filters:**

```javascript
GET /api/products?page=1&limit=20&search=iPhone&categoryId=64a1b2c3d4e5f6789012345&isActive=true
```

### **4. Create Inbound:**

```javascript
POST / api / inbound;
Authorization: Bearer <
  token >
  {
    supplierId: "64a1b2c3d4e5f6789012346",
    warehouseId: "64a1b2c3d4e5f6789012347",
    expectedDate: "2024-01-15T10:00:00Z",
    items: [
      {
        productId: "64a1b2c3d4e5f6789012345",
        quantity: 100,
        unitCost: 800.0,
      },
    ],
    notes: "Bulk order from supplier",
  };
```

## üìã **Health Check**

### **Endpoint:**

```javascript
GET / api / health;
```

### **Response:**

```javascript
{
  "success": true,
  "message": "E-Log API is running",
  "timestamp": "2024-01-15T10:00:00.000Z",
  "version": "1.0.0"
}
```

## üéâ **K·∫øt Lu·∫≠n**

H·ªá th·ªëng routes ƒë√£ ƒë∆∞·ª£c ho√†n thi·ªán v·ªõi:

- ‚úÖ **11 route modules** ho√†n ch·ªânh
- ‚úÖ **Authentication middleware** m·∫°nh m·∫Ω
- ‚úÖ **Comprehensive validation** cho t·∫•t c·∫£ endpoints
- ‚úÖ **Role-based access control**
- ‚úÖ **RESTful API design**
- ‚úÖ **Error handling chu·∫©n h√≥a**
- ‚úÖ **Documentation ƒë·∫ßy ƒë·ªß**
- ‚úÖ **Messages ti·∫øng Vi·ªát** cho t·∫•t c·∫£ validation

**T·ªïng c·ªông: 50+ endpoints** s·∫µn s√†ng cho production! üöÄ

## üáªüá≥ **Ti·∫øng Vi·ªát H√≥a**

T·∫•t c·∫£ validation messages ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi sang ti·∫øng Vi·ªát ƒë·ªÉ ph√π h·ª£p v·ªõi ng∆∞·ªùi d√πng Vi·ªát Nam:

### **V√≠ d·ª• Messages:**

- **Auth:** "T√™n ƒëƒÉng nh·∫≠p ph·∫£i c√≥ t·ª´ 3 ƒë·∫øn 20 k√Ω t·ª±"
- **Products:** "T√™n s·∫£n ph·∫©m l√† b·∫Øt bu·ªôc", "SKU ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ hoa, s·ªë v√† d·∫•u g·∫°ch ngang"
- **Categories:** "T√™n danh m·ª•c ph·∫£i c√≥ t·ª´ 1 ƒë·∫øn 50 k√Ω t·ª±"
- **Customers:** "T√™n kh√°ch h√†ng l√† b·∫Øt bu·ªôc", "Lo·∫°i kh√°ch h√†ng ph·∫£i l√† c√° nh√¢n ho·∫∑c doanh nghi·ªáp"
- **Inventory:** "S·ªë l∆∞·ª£ng ph·∫£i l√† s·ªë nguy√™n kh√¥ng √¢m"
- **Inbound/Outbound:** "C·∫ßn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m", "Ng√†y d·ª± ki·∫øn ph·∫£i l√† ƒë·ªãnh d·∫°ng ISO 8601 h·ª£p l·ªá"
- **Reports:** "ƒê·ªãnh d·∫°ng ph·∫£i l√† m·ªôt trong: json, csv, pdf"

### **L·ª£i √≠ch:**

- ‚úÖ **User-friendly** - Ng∆∞·ªùi d√πng Vi·ªát Nam d·ªÖ hi·ªÉu
- ‚úÖ **Professional** - Th√¥ng b√°o l·ªói chuy√™n nghi·ªáp
- ‚úÖ **Consistent** - Nh·∫•t qu√°n trong to√†n b·ªô h·ªá th·ªëng
- ‚úÖ **Maintainable** - D·ªÖ b·∫£o tr√¨ v√† c·∫≠p nh·∫≠t
